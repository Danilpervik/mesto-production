(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(n){if(n.ep)return;n.ep=!0;const c=o(n);fetch(n.href,c)}})();const l={baseUrl:"https://mesto.nomoreparties.co/v1/apf-cohort-202",headers:{authorization:"0bd39914-2bdd-4540-b604-9496f53116d0","Content-Type":"application/json"}},p=e=>e.ok?e.json():Promise.reject(`–û—à–∏–±–∫–∞: ${e.status}`),ce=()=>fetch(`${l.baseUrl}/users/me`,{headers:l.headers}).then(p),j=()=>fetch(`${l.baseUrl}/cards`,{headers:l.headers}).then(p),le=({name:e,about:t})=>fetch(`${l.baseUrl}/users/me`,{method:"PATCH",headers:l.headers,body:JSON.stringify({name:e,about:t})}).then(p),se=e=>fetch(`${l.baseUrl}/users/me/avatar`,{method:"PATCH",headers:l.headers,body:JSON.stringify({avatar:e})}).then(p),ie=({name:e,link:t})=>fetch(`${l.baseUrl}/cards`,{method:"POST",headers:l.headers,body:JSON.stringify({name:e,link:t})}).then(p),ue=e=>fetch(`${l.baseUrl}/cards/${e}`,{method:"DELETE",headers:l.headers}).then(p),ae=(e,t)=>{let o;return t?o="DELETE":o="PUT",fetch(`${l.baseUrl}/cards/likes/${e}`,{method:o,headers:l.headers}).then(p)},J=e=>{if(e.key==="Escape"){const t=document.querySelector(".popup_is-opened");a(t)}},_=e=>{e.classList.add("popup_is-opened"),document.addEventListener("keyup",J)},a=e=>{e.classList.remove("popup_is-opened"),document.removeEventListener("keyup",J)},de=e=>{e.querySelector(".popup__close").addEventListener("click",()=>{a(e)}),e.addEventListener("mousedown",o=>{o.target.classList.contains("popup")&&a(e)})},pe=(e,t,o,r)=>{const n=e.querySelector(`#${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)},R=(e,t,o)=>{const r=e.querySelector(`#${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},fe=(e,t,o)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage||""):t.setCustomValidity(""),t.validity.valid?R(e,t,o):pe(e,t,t.validationMessage,o)},_e=e=>e.some(t=>!t.validity.valid),z=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},me=(e,t)=>{e.classList.remove(t.inactiveButtonClass),e.disabled=!1},A=(e,t,o)=>{_e(e)?z(t,o):me(t,o)},ye=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);A(o,r,t),o.forEach(n=>{n.addEventListener("input",()=>{fe(e,n,t),A(o,r,t)})})},I=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach(n=>{R(e,n,t),n.setCustomValidity("")}),z(r,t)},he=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach(o=>{ye(o,e)})},b={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},k=document.querySelector(".places__list"),E=document.querySelector(".popup_type_edit"),y=E.querySelector(".popup__form"),K=y.querySelector(".popup__input_type_name"),G=y.querySelector(".popup__input_type_description"),N=y.querySelector(".popup__button"),w=document.querySelector(".popup_type_new-card"),d=w.querySelector(".popup__form"),Se=d.querySelector(".popup__input_type_card-name"),ve=d.querySelector(".popup__input_type_url"),F=d.querySelector(".popup__button"),x=document.querySelector(".popup_type_image"),O=x.querySelector(".popup__image"),Ce=x.querySelector(".popup__caption"),P=document.querySelector(".popup_type_remove-card"),Q=P.querySelector(".popup__form"),X=Q.querySelector(".popup__button"),h=document.querySelector(".popup_type_info"),Y=h.querySelector(".popup__title"),u=h.querySelector(".popup__info"),W=h.querySelector(".popup__text"),q=h.querySelector(".popup__list"),be=document.querySelector(".profile__edit-button"),ge=document.querySelector(".profile__add-button"),T=document.querySelector(".profile__title"),U=document.querySelector(".profile__description"),g=document.querySelector(".profile__image"),M=document.querySelector(".popup_type_edit-avatar"),f=M.querySelector(".popup__form"),D=f.querySelector(".popup__input"),H=f.querySelector(".popup__button"),Le=document.querySelector("#popup-info-definition-template"),qe=document.querySelector("#popup-info-user-preview-template");let v=null,C=null;const Z=({name:e,link:t})=>{O.src=t,O.alt=e,Ce.textContent=e,_(x)},ke=e=>e.toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"});function m(e,t){const r=Le.content.cloneNode(!0).querySelector(".popup__info-item"),n=r.querySelector(".popup__info-term"),c=r.querySelector(".popup__info-description");return n.textContent=e,c.textContent=t,r}function Ie(e){const o=qe.content.cloneNode(!0).querySelector(".popup__list-item");return o.textContent=e.name||"–ê–Ω–æ–Ω–∏–º",o.className="popup__list-item",o.style.backgroundImage="none",o.style.backgroundColor="transparent",o}function ee(e,t){console.log("üìä –û—Ç–∫—Ä—ã–≤–∞—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–∞—Ä—Ç–æ—á–∫–µ:",e),t&&V(t),j().then(o=>{console.log("‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —Å —Å–µ—Ä–≤–µ—Ä–∞, –∫–∞—Ä—Ç–æ—á–µ–∫:",o.length);const r=o.find(n=>n._id===e);if(!r){console.log("‚ùå –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ");return}console.log("‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞–π–¥–µ–Ω–∞:",r),console.log("–õ–∞–π–∫–∏ –∫–∞—Ä—Ç–æ—á–∫–∏:",r.likes),V(r)}).catch(o=>{console.log("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞:",o),t||(Y.textContent="–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏",u.innerHTML='<div class="error">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</div>')})}function V(e){if(u.innerHTML="",q.innerHTML="",W.textContent="",Y.textContent=e.name||"–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è",u.append(m("–û–ø–∏—Å–∞–Ω–∏–µ:",e.name||"–ù–µ —É–∫–∞–∑–∞–Ω–æ")),e.createdAt)try{const o=new Date(e.createdAt);isNaN(o.getTime())||u.append(m("–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:",ke(o)))}catch(o){console.log("–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:",o)}e.owner&&e.owner.name?u.append(m("–í–ª–∞–¥–µ–ª–µ—Ü:",e.owner.name)):e.owner&&e.owner._id&&u.append(m("–í–ª–∞–¥–µ–ª–µ—Ü:",`ID: ${e.owner._id}`));const t=e.likes?e.likes.length:0;if(u.append(m("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∞–π–∫–æ–≤:",t.toString())),W.textContent="–õ–∞–π–∫–Ω—É–ª–∏:",e.likes&&e.likes.length>0)console.log("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, –ª–∞–π–∫–Ω—É–≤—à–∏–µ –∫–∞—Ä—Ç–æ—á–∫—É:",e.likes),e.likes.forEach((o,r)=>{console.log(`–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ${r+1}:`,o);const n=Ie(o);q.append(n)});else{const o=document.createElement("li");o.textContent="–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ª–∞–π–∫–Ω—É–ª",o.className="popup__list-item",q.append(o)}_(h)}function Ee(e,t){e.style.opacity="0.5",e.style.transition="opacity 0.3s",ue(t).then(()=>{console.log("‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞"),setTimeout(()=>{e.remove(),console.log("‚úÖ –ö–∞—Ä—Ç–æ—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ DOM")},300)}).catch(o=>{console.log("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏:",o),e.style.opacity="1"}).finally(()=>{i(!1,X,"–î–∞","–£–¥–∞–ª–µ–Ω–∏–µ...")})}function we(e,t){v=e,C=t,_(P)}function te(e,t){we(e,t)}function oe(e,t){const o=e.querySelector(".card__like-button"),r=e.querySelector(".card__like-count"),n=o.classList.contains("card__like-button_is-active");if(o.classList.toggle("card__like-button_is-active"),r){const c=parseInt(r.textContent)||0;r.textContent=n?c-1:c+1}ae(t._id,n).then(c=>{console.log("‚úÖ –°—Ç–∞—Ç—É—Å –ª–∞–π–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"),r&&(r.textContent=c.likes.length)}).catch(c=>{if(console.log("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ª–∞–π–∫–∞:",c),o.classList.toggle("card__like-button_is-active"),r){const s=parseInt(r.textContent)||0;r.textContent=n?s+1:s-1}})}function i(e,t,o,r){e?(t.textContent=r,t.disabled=!0):(t.textContent=o,t.disabled=!1)}const xe=e=>{e.preventDefault(),i(!0,N,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."),le({name:K.value,about:G.value}).then(t=>{T.textContent=t.name,U.textContent=t.about,g.style.backgroundImage=`url(${t.avatar})`,a(E)}).catch(t=>{console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª—è:",t)}).finally(()=>{i(!1,N,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...")})},Pe=e=>{e.preventDefault(),console.log("üîÑ –û—Ç–ø—Ä–∞–≤–ª—è—é –∞–≤–∞—Ç–∞—Ä:",D.value),i(!0,H,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ..."),se(D.value).then(t=>{console.log("‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:",t.avatar),g.style.backgroundImage=`url(${t.avatar})`,a(M),f.reset()}).catch(t=>{console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞:",t)}).finally(()=>{i(!1,H,"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å","–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...")})},Te=e=>{e.preventDefault(),i(!0,F,"–°–æ–∑–¥–∞—Ç—å","–°–æ–∑–¥–∞–Ω–∏–µ..."),ie({name:Se.value,link:ve.value}).then(t=>{k.prepend(ne(t,{onPreviewPicture:Z,onLikeIcon:oe,onDeleteCard:te,onInfoClick:ee,currentUserId:t.owner._id})),a(w),d.reset()}).catch(t=>{console.log("–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏:",t)}).finally(()=>{i(!1,F,"–°–æ–∑–¥–∞—Ç—å","–°–æ–∑–¥–∞–Ω–∏–µ...")})},Ue=e=>{e.preventDefault(),v&&C&&(i(!0,X,"–î–∞","–£–¥–∞–ª–µ–Ω–∏–µ..."),Ee(v,C)),a(P),v=null,C=null};y.addEventListener("submit",xe);d.addEventListener("submit",Te);f.addEventListener("submit",Pe);Q.addEventListener("submit",Ue);be.addEventListener("click",()=>{K.value=T.textContent,G.value=U.textContent,I(y,b),_(E)});g.addEventListener("click",()=>{f.reset(),I(f,b),_(M)});ge.addEventListener("click",()=>{d.reset(),I(d,b),_(w)});const Me=document.querySelectorAll(".popup");Me.forEach(e=>{de(e)});he(b);function ne(e,t={}){const n=document.querySelector("#card-template").content.cloneNode(!0).querySelector(".places__item"),c=n.querySelector(".card__image"),s=n.querySelector(".card__title"),L=n.querySelector(".card__control-button_type_delete"),B=n.querySelector(".card__control-button_type_info"),S=n.querySelector(".card__like-button"),$=n.querySelector(".card__like-count");return c.src=e.link,c.alt=e.name,s.textContent=e.name,$&&e.likes&&($.textContent=e.likes.length),c.addEventListener("click",()=>{t.onPreviewPicture&&t.onPreviewPicture(e)}),B&&t.onInfoClick&&B.addEventListener("click",()=>{t.onInfoClick(e._id,e)}),S&&t.onLikeIcon&&S.addEventListener("click",()=>{t.onLikeIcon(n,e)}),t.currentUserId&&e.owner&&e.owner._id!==t.currentUserId&&(L.style.display="none"),L&&t.onDeleteCard&&t.currentUserId&&e.owner&&e.owner._id===t.currentUserId&&L.addEventListener("click",()=>{t.onDeleteCard(n,e._id)}),t.currentUserId&&e.likes&&e.likes.some(re=>re._id===t.currentUserId)&&S&&S.classList.add("card__like-button_is-active"),n}Promise.all([j(),ce()]).then(([e,t])=>{T.textContent=t.name,U.textContent=t.about,g.style.backgroundImage=`url(${t.avatar})`;const o=t._id;k.innerHTML="",e.reverse().forEach(r=>{k.append(ne(r,{onPreviewPicture:Z,onLikeIcon:oe,onDeleteCard:te,onInfoClick:ee,currentUserId:o}))})}).catch(e=>{console.log("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:",e)});
